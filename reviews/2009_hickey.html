<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimation of Prediction Error Variances via Monte Carlo Sampling Methods</title>
    <link rel="stylesheet" href="style.css">

<script>
(function() {
    'use strict';

    function initTheme() {
        const filename = location.pathname.split('/').pop().replace('.html', '') || 'default';
        
        let seed = 0;
        
        // Mix all character codes into the seed with prime multipliers
        for (let i = 0; i < filename.length; i++) {
            seed += filename.charCodeAt(i) * (31 + (i % 7));
        }

        // Extract year if any (4-digit number in filename)
        const yearMatch = filename.match(/\d{4}/);
        if (yearMatch) {
            seed += parseInt(yearMatch[0]) * 13;
        }

        // Further mix with golden ratio to scatter more
        seed = Math.floor((seed * 0.6180339887) % 1 * 10000);

        const themeNumber = (seed % 30) + 1; // Result: 1 to 30

        document.body.setAttribute('data-theme', 'auto-' + themeNumber);
        if (yearMatch) {
            document.body.setAttribute('data-year', yearMatch[0]);
        }
    }

    function initBackToTop() {
        const btn = document.createElement('div');
        btn.className = 'back-to-top';
        btn.setAttribute('aria-label', 'Back to top');
        btn.onclick = () => window.scrollTo({top: 0, behavior: 'smooth'});
        document.body.appendChild(btn);
        
        window.onscroll = () => {
            btn.classList.toggle('visible', window.pageYOffset > 300);
        };
    }

    document.readyState === 'loading'
        ? document.addEventListener('DOMContentLoaded', () => {initTheme(); initBackToTop();})
        : (initTheme(), initBackToTop());
})();
</script>

</head>
<body>
    <div class="container">
        <!-- TOP LEFT NAVIGATION -->
        <div class="top-left-nav">
            <a href="../index.html">Back to Index</a>
        </div>
        
        <div class="header">
            <h1>Estimation of Prediction Error Variances via Monte Carlo Sampling Methods</h1>
            <p>Comparative Analysis of Computational Formulations for Genetic Evaluation</p>
            
            <div class="header-info">
                <p class="text-small"><strong>Authors:</strong> John M. Hickey, Roel F. Veerkamp, Mario P.L. Calus, Han A. Mulder, Robin Thompson</p>
                <p class="text-small text-top"><strong>Journal:</strong> Genetics Selection Evolution, 2009, 41:23</p>
                <p class="text-small text-top"><strong>Institutions:</strong> Animal Breeding and Genomics Centre (Netherlands), Teagasc (Ireland), University College Dublin, Queen Mary University of London, Rothamsted Research</p>
                <p class="text-top-large">
                    <a href="https://doi.org/10.1186/1297-9686-41-23"
                       target="_blank" 
                       class="paper-link">
                         View Original Paper
                    </a>
                </p>
            </div>
        </div>
        
        <div class="content">
            <div class="section" id="section-overview">
                <div class="section-title">Research Context & Computational Challenge</div>
                
                <div class="problem-box">
                    <strong>Critical Computational Bottleneck:</strong> Calculation of exact prediction error variance-covariance matrices is computationally prohibitive for large-scale genetic evaluations (100,000 to 20,000,000 equations), limiting applications in REML algorithms, accuracy estimation, and variance control in breeding programs.
                </div>
                
                <div class="citation-box">
                    <p><strong>Citation:</strong> Hickey, J. M., Veerkamp, R. F., Calus, M. P. L., Mulder, H. A., & Thompson, R. (2009). Estimation of prediction error variances via Monte Carlo sampling methods using different formulations of the prediction error variance. Genetics Selection Evolution, 41(1), 23.</p>
                    
                    <p><strong>Key Background References:</strong></p>
                    <ul class="list-top">
                        <li>García-Cortés et al. (1995): Three foundational formulations for Monte Carlo PEV estimation</li>
                        <li>Fouilloux and Laloë (2001): Alternative formulation using covariance information</li>
                        <li>Henderson (1975, 1976): Theoretical foundations of BLUP and relationship matrix computations</li>
                        <li>Thompson (1979): REML integration with prediction error variance calculations</li>
                    </ul>
                </div>
            </div>

            <div class="section" id="section-methodology">
                <div class="section-title">Monte Carlo Sampling Framework</div>
                
                <div class="flow-container">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">Core Monte Carlo Procedure</div>
                            <div class="step-details">
                                Three-step process for approximating prediction error variances
                                <div class="step-specs">
                                    <strong>Step 1:</strong> Simulate n samples of y and u using original data structure<br>
                                    <strong>Step 2:</strong> Solve mixed model equations for each simulated dataset<br>
                                    <strong>Step 3:</strong> Calculate sampled PEV using specific formulation<br>
                                    <strong>Key Innovation:</strong> Use random normal deviates from N(0, ZGZ' + R) instead of N(Xb, ZGZ' + R)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">Data Structure and Model</div>
                            <div class="step-details">
                                Limousin cattle dataset for comprehensive validation
                                <div class="step-specs">
                                    <strong>Dataset:</strong> 32,128 purebred Limousin animals with height records<br>
                                    <strong>Pedigree:</strong> 50,435 animals total<br>
                                    <strong>Variance Components:</strong> σ²g = 1.0, σ²r = 3.0<br>
                                    <strong>Fixed Effects:</strong> Contemporary group, technician, parity of dam, age, sex
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">Formulation Comparison Design</div>
                            <div class="step-details">
                                Systematic evaluation of ten different PEV formulations
                                <div class="step-specs">
                                    <strong>Sample Sizes:</strong> n = 50, 100, ..., 950, 1000<br>
                                    <strong>Exact PEV Reference:</strong> Calculated using ASReml with full matrix inversion<br>
                                    <strong>Validation Methods:</strong> 100,000 Monte Carlo samples for each formulation<br>
                                    <strong>Performance Metrics:</strong> Correlation, slope, R², RMSE across PEV levels
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title">Computational Implementation</div>
                            <div class="step-details">
                                Numerically stable algorithms for variance calculations
                                <div class="step-specs">
                                    <strong>Algorithm:</strong> One-pass updating based on Chan et al. (1979)<br>
                                    <strong>Memory Management:</strong> Streaming calculations for 100,000 samples<br>
                                    <strong>Software:</strong> MiX99 for MME solving, custom algorithms for variance updates<br>
                                    <strong>Stability:</strong> Tested and verified against textbook formulations
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Ten Formulations Compared</div>
                
                <div class="model-comparison">
                    <div class="model-box model-1">
                        <div class="model-title">Published Formulations (4)</div>
                        <div class="step-details">
                            <strong>PEVGC1:</strong> σ²g - Var(û)
                            <div class="formula">Uses Cov(u, û) = Var(û), Var(u) = σ²g</div>
                            
                            <strong>PEVGC2:</strong> Var(u - û)
                            <div class="formula">Assumes Cov(u - û, û) = 0</div>
                            
                            <strong>PEVGC3:</strong> Weighted combination of GC1 and GC2
                            <div class="formula">Weights based on asymptotic sampling variances</div>
                            
                            <strong>PEVFL:</strong> σ²g - Cov(u, û)
                            <div class="formula">Uses covariance information directly</div>
                        </div>
                    </div>
                    
                    <div class="model-box model-2">
                        <div class="model-title">Alternative Formulations (4)</div>
                        <div class="step-details">
                            <strong>PEVAF1-4:</strong> Corrected versions of published formulations
                            <div class="formula">Rescale from Var(u) to σ²g scale</div>
                            
                            <strong>Key Innovation:</strong> Account for sampling effects on Var(u)
                            <ul>
                                <li>PEVAF1: σ²g - [Var(û)/Var(u)] × σ²g</li>
                                <li>PEVAF2: [Var(u - û)/Var(u)] × σ²g</li>
                                <li>PEVAF3: Weighted combination of AF1 and AF2</li>
                                <li>PEVAF4: σ²g - [Cov(u, û)/Var(u)] × σ²g</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="model-comparison">
                    <div class="model-box model-3">
                        <div class="model-title">New Formulations (2)</div>
                        <div class="step-details">
                            <strong>PEVNF1:</strong> Based on classical EBV accuracy formula
                            <div class="formula">σ²g × [1 - Cov(u, û)²/(Var(u) × Var(û))]</div>
                            
                            <strong>PEVNF2:</strong> Implicit weighting approach
                            <div class="formula">{Var(u - û)/[Var(û) + Var(u - û)]} × σ²g</div>
                            
                            <strong>Advantages:</strong>
                            <ul>
                                <li>PEVNF2 shows excellent performance across all PEV levels</li>
                                <li>Symmetric sampling variance curves</li>
                                <li>Competitive with best weighted formulations</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="section-analysis">
                <div class="section-title">Performance Analysis & Results</div>
                
                <div class="analysis-grid">
                    <div class="analysis-card why-card">
                        <div class="analysis-title">WHY - Computational Necessity</div>
                        <div class="step-details">
                            <strong>Scale Challenge:</strong> Modern genetic evaluations require PEV for millions of animals but exact calculation is computationally impossible.
                            
                            <ul>
                                <li>REML algorithms need PEV for unbiased variance component estimation</li>
                                <li>Breeding value accuracies require prediction error variances</li>
                                <li>Selection response variance control needs PEV information</li>
                                <li>Matrix inversion for 20 million equations is computationally infeasible</li>
                            </ul>
                            
                            <strong>Solution Need:</strong> Approximation methods that converge to exact values with practical computational requirements.
                        </div>
                    </div>
                    
                    <div class="analysis-card how-card">
                        <div class="analysis-title">HOW - Method Development</div>
                        <div class="step-details">
                            <strong>Comparative Evaluation:</strong> Systematic comparison of ten different PEV formulations using Monte Carlo sampling.
                            
                            <ul>
                                <li><strong>Simulation:</strong> Generate multiple datasets with known structure</li>
                                <li><strong>Solve:</strong> Run mixed model equations on each simulated dataset</li>
                                <li><strong>Compare:</strong> Calculate PEV using different formulations</li>
                                <li><strong>Validate:</strong> Compare against exact PEV from full matrix inversion</li>
                            </ul>
                            
                            <strong>Innovation:</strong> Correct published formulations for sampling effects and develop new weighted approaches.
                        </div>
                    </div>
                    
                    <div class="analysis-card what-card">
                        <div class="analysis-title">WHAT - Key Discoveries</div>
                        <div class="step-details">
                            <strong>Performance Hierarchy:</strong> Four formulations emerged as clearly superior.
                            
                            <ul>
                                <li><span class="highlight">Best Performers:</span> PEVGC3, PEVAF3, PEVAF4, PEVNF2</li>
                                <li><span class="highlight">Convergence:</span> All formulations converge to exact PEV as samples increase</li>
                                <li><span class="highlight">PEV Level Dependency:</span> Performance varies with low/medium/high PEV levels</li>
                                <li><span class="highlight">Practical Recommendation:</span> 300 samples provide satisfactory convergence</li>
                            </ul>
                            
                            <strong>Impact:</strong> Enables practical implementation of stochastic REML and accurate breeding value reliability estimation.
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Detailed Performance Results</div>
                
                <div class="results-grid">
                    <div class="results-box">
                        <div class="results-title">Convergence Performance (n=300 samples)</div>
                        <div class="step-details">
                            <strong>Low PEV (0.00-0.33):</strong>
                            <ul>
                                <li>PEVNF2: R² = 0.95, Slope = 0.95, RMSE = 0.02</li>
                                <li>PEVGC3: R² = 0.95, Slope = 0.93, RMSE = 0.02</li>
                                <li>PEVGC2: R² = 0.94, Slope = 0.90, RMSE = 0.02</li>
                                <li>Poor performers: PEVGC1, PEVFL (R² = 0.65)</li>
                            </ul>
                            
                            <strong>High PEV (0.67-1.00):</strong>
                            <ul>
                                <li>PEVNF2: R² = 0.98, Slope = 0.96, RMSE = 0.01</li>
                                <li>PEVGC3: R² = 0.97, Slope = 0.94, RMSE = 0.02</li>
                                <li>PEVGC1: R² = 0.96, Slope = 0.91, RMSE = 0.02</li>
                                <li>Poor performer: PEVGC2 (R² = 0.64)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="results-box">
                        <div class="results-title">Sampling Variance Analysis</div>
                        <div class="step-details">
                            <strong>PEV Level Dependencies:</strong>
                            <ul>
                                <li>Var(û) has lower sampling variance at high PEVexact</li>
                                <li>Var(u - û) has lower sampling variance at low PEVexact</li>
                                <li>Best formulations use both information sources with optimal weighting</li>
                                <li>Symmetric sampling variance curves indicate balanced performance</li>
                            </ul>
                            
                            <strong>Weighting Strategies:</strong>
                            <ul>
                                <li>Asymptotic weighting: Computationally efficient</li>
                                <li>Jackknife weighting: Empirically robust</li>
                                <li>Independent replicates: Gold standard but computationally expensive</li>
                                <li>All three approaches give nearly identical results</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="section-technical">
                <div class="section-title">Technical Implementation & Requirements</div>
                
                <div class="comparison-grid">
                    <div class="comparison-box census-box">
                        <div class="comparison-title">Computational Specifications</div>
                        <div class="step-details">
                            <strong>Sample Size Requirements:</strong>
                            <ul>
                                <li><span class="highlight">Minimum:</span> 50 samples for basic approximation</li>
                                <li><span class="highlight">Recommended:</span> 300 samples for satisfactory convergence</li>
                                <li><span class="highlight">High Precision:</span> 550+ samples for intermediate PEV accuracy ≥ 0.90</li>
                                <li><span class="highlight">Optimal:</span> 1000 samples for research applications</li>
                            </ul>
                            
                            <strong>Performance Scaling:</strong>
                            <ul>
                                <li>Single evaluation: 366 minutes (Irish dataset, 1.5M animals)</li>
                                <li>300 samples: 1,830 hours on single processor</li>
                                <li>Parallel implementation: 38.1 hours on 6 × 8-core PCs</li>
                                <li>Cost-effective: ~€30,000 hardware investment</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="comparison-box dna-box">
                        <div class="comparison-title">Algorithmic Implementation</div>
                        <div class="step-details">
                            <strong>Numerical Stability:</strong>
                            <ul>
                                <li><span class="highlight">Variance Calculation:</span> One-pass updating algorithm (Chan et al.)</li>
                                <li><span class="highlight">Memory Efficiency:</span> Streaming computation for large datasets</li>
                                <li><span class="highlight">Precision:</span> Avoids numerical instability of textbook formulas</li>
                                <li><span class="highlight">Validation:</span> Tested against exact calculations</li>
                            </ul>
                            
                            <strong>Software Integration:</strong>
                            <ul>
                                <li>MiX99 for mixed model equation solving</li>
                                <li>ASReml for exact PEV reference calculations</li>
                                <li>Custom algorithms for efficient variance updates</li>
                                <li>Parallelizable across multiple processors</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Formulation Comparison Matrix</div>
                
                <div class="method-comparison">
                    <div class="method-box method-1">
                        <div class="method-title">Best Performing Formulations</div>
                        <div class="step-details">
                            <strong>PEVGC3 (Weighted García-Cortés):</strong>
                            <ul>
                                <li>Combines GC1 and GC2 using asymptotic sampling variances</li>
                                <li>Symmetric performance across PEV levels</li>
                                <li>Established theoretical foundation</li>
                                <li>Good computational efficiency</li>
                            </ul>
                            
                            <strong>PEVAF3 (Alternative Weighted):</strong>
                            <ul>
                                <li>Corrects for Var(u) ≠ σ²g sampling effects</li>
                                <li>Improved performance over PEVGC3</li>
                                <li>Robust across different PEV ranges</li>
                                <li>Recommended for practical applications</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="method-box method-2">
                        <div class="method-title">Practical Recommendations</div>
                        <div class="step-details">
                            <strong>PEVAF4 (Alternative Fouilloux-Laloë):</strong>
                            <ul>
                                <li>Major improvement over original PEVFL</li>
                                <li>Excellent performance at low/intermediate PEV</li>
                                <li>Uses covariance information effectively</li>
                                <li>Nearly identical to PEVNF2</li>
                            </ul>
                            
                            <strong>PEVNF2 (New Formulation):</strong>
                            <ul>
                                <li>Implicitly weights Var(û) and Var(u - û) information</li>
                                <li>Symmetric sampling variance curves</li>
                                <li>Competitive with best weighted approaches</li>
                                <li>Simple implementation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="section-applications">
                <div class="section-title">Applications & Future Implications</div>
                
                <div class="innovation-box">
                    <div class="innovation-title">🎯 Key Innovation</div>
                    <p>First comprehensive comparison of Monte Carlo PEV formulations, identifying optimal approaches for different PEV levels and establishing practical guidelines for large-scale genetic evaluation applications.</p>
                </div>
                
                <div class="theme-container">
                    <div class="theme-box methodological">
                        <div class="theme-title">Computational Applications</div>
                        <div class="step-details">
                            <ul>
                                <li><strong>Stochastic REML:</strong> Enable variance component estimation with complete datasets</li>
                                <li><strong>Accuracy Calculation:</strong> Provide unbiased breeding value reliabilities</li>
                                <li><strong>Selection Response Control:</strong> Manage variance of genetic gain in breeding programs</li>
                                <li><strong>Large-Scale Evaluation:</strong> Make previously impossible calculations feasible</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="theme-box genetic">
                        <div class="theme-title">Breeding Program Benefits</div>
                        <div class="step-details">
                            <ul>
                                <li><strong>Reduced Bias:</strong> Use complete datasets instead of reduced sets for variance estimation</li>
                                <li><strong>Improved Accuracy:</strong> Better reliability estimates for breeding value predictions</li>
                                <li><strong>Risk Management:</strong> Control variance of selection response</li>
                                <li><strong>Economic Impact:</strong> More efficient breeding decisions with better uncertainty quantification</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Implementation Guidelines</div>
                
                <div class="gap-analysis">
                    <div class="gap-title">📋 Practical Implementation Steps</div>
                    <div class="gap-content">
                        <strong>For Routine Genetic Evaluation:</strong>
                        <ul>
                            <li>Use PEVAF3 or PEVNF2 for general applications with balanced performance</li>
                            <li>Implement with 300 samples for satisfactory accuracy</li>
                            <li>Use parallel processing to reduce computational time</li>
                            <li>Validate against exact PEV for subset of animals</li>
                        </ul>
                        
                        <strong>For Research Applications:</strong>
                        <ul>
                            <li>Use 550+ samples for high precision requirements</li>
                            <li>Consider PEV level when choosing formulation</li>
                            <li>Implement multiple formulations for comparison</li>
                            <li>Use asymptotic weighting for computational efficiency</li>
                        </ul>
                    </div>
                </div>
                
                <div class="significance-box">
                    <div class="significance-title">🔬 Future Research Directions</div>
                    <div class="significance-content">
                        <strong>Methodological Extensions:</strong>
                        <ul>
                            <li>Adaptation to genomic evaluation models with marker effects</li>
                            <li>Extension to multi-trait and random regression models</li>
                            <li>Development of adaptive sampling strategies</li>
                            <li>Integration with Bayesian methods and MCMC</li>
                        </ul>
                        
                        <strong>Computational Advances:</strong>
                        <ul>
                            <li>GPU acceleration for massive parallel processing</li>
                            <li>Cloud computing implementations for accessibility</li>
                            <li>Distributed computing across multiple institutions</li>
                            <li>Real-time accuracy estimation in breeding programs</li>
                        </ul>
                    </div>
                </div>
                
                <div class="section-title">Technical Specifications Summary</div>
                
                <div class="coverage-stats">
                    <div class="stat-box">
                        <div class="stat-number">10</div>
                        <div class="stat-label">Formulations Compared</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Top Performers Identified</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-number">300</div>
                        <div class="stat-label">Recommended Sample Size</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-number">100K</div>
                        <div class="stat-label">Monte Carlo Samples Used</div>
                    </div>
                </div>
                
                <div class="experiment-details">
                    <strong>Validation Dataset Characteristics:</strong>
                    <ul>
                        <li>32,128 Limousin cattle with height records</li>
                        <li>50,435 animals in complete pedigree</li>
                        <li>PEV range: 0.00 to 1.00 (categorized as low/medium/high)</li>
                        <li>Exact PEV calculated using ASReml with full matrix inversion</li>
                        <li>18,855 non-inbred animals used for final analysis</li>
                    </ul>
                </div>
            </div>

            <div class="section" id="section-impact">
                <div class="section-title">Research Impact & Legacy</div>
                
                <div class="theme-container">
                    <div class="theme-box historical">
                        <div class="theme-title">Historical Context</div>
                        <div class="step-details">
                            <ul>
                                <li><strong>Pre-2009:</strong> Limited options for PEV approximation in large datasets</li>
                                <li><strong>García-Cortés Era:</strong> Initial Monte Carlo formulations (1995)</li>
                                <li><strong>Computational Barrier:</strong> Matrix inversion limitations restricting applications</li>
                                <li><strong>Industry Need:</strong> Growing demand for accuracy estimation in genomic era</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="theme-box methodological">
                        <div class="theme-title">Methodological Impact</div>
                        <div class="step-details">
                            <ul>
                                <li><strong>Standardization:</strong> Established benchmarks for PEV approximation methods</li>
                                <li><strong>Correction Formulas:</strong> Improved published methods with sampling corrections</li>
                                <li><strong>Performance Metrics:</strong> Comprehensive evaluation framework for future methods</li>
                                <li><strong>Practical Guidelines:</strong> Sample size recommendations for different applications</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Limitations & Future Challenges</div>
                
                <div class="gap-analysis">
                    <div class="gap-title">⚠️ Current Limitations</div>
                    <div class="gap-content">
                        <strong>Computational Constraints:</strong>
                        <ul>
                            <li>Still computationally intensive despite improvements (1,830 hours for Irish dataset)</li>
                            <li>Memory requirements scale with dataset size and number of samples</li>
                            <li>Parallel processing requires significant hardware investment</li>
                            <li>Real-time applications remain challenging for largest evaluations</li>
                        </ul>
                        
                        <strong>Methodological Considerations:</strong>
                        <ul>
                            <li>Performance varies significantly across PEV levels within formulations</li>
                            <li>Optimal sample size depends on precision requirements and computational budget</li>
                            <li>Limited evaluation of genomic models with dense marker effects</li>
                            <li>Inbreeding corrections not fully validated in this study</li>
                        </ul>
                    </div>
                </div>
                
                <div class="significance-box">
                    <div class="significance-title">🌟 Long-term Significance</div>
                    <div class="significance-content">
                        <strong>Enabling Technologies:</strong>